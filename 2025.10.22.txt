mport javax.servlet.http.HttpSession;
import javax.websocket.server.ServerEndpointConfig;
import javax.websocket.server.HandshakeRequest;
import javax.websocket.server.HandshakeResponse;

public class WebSocketConfigurator extends ServerEndpointConfig.Configurator {
    @Override
    public void modifyHandshake(ServerEndpointConfig sec,
                                HandshakeRequest request,
                                HandshakeResponse response) {
        HttpSession httpSession = (HttpSession) request.getHttpSession();
        // í•„ìš”í•˜ë©´ httpSessionì—ì„œ ë¡œê·¸ì¸ ì •ë³´ ê°€ì ¸ì™€ WebSocket ì„¸ì…˜ì— ë„£ê¸°
        sec.getUserProperties().put("session", httpSession);
    }



<!-- ì›¹ì†Œì¼“ ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
<dependency>
  <groupId>org.springframework.boot</groupId>
  <artifactId>spring-boot-starter-websocket</artifactId>
</dependency>


<dependency>
 <groupId>org.springframework.boot</groupId>
 <artifactId>spring-boot-starter-security</artifactId>
</dependency>




ì•„ìš” ğŸ‘
ì§€ê¸ˆ êµ¬ì¡° (CatEndpoint) ë³´ë©´, ë©”ì‹œì§€ë¥¼ ChtaDTOë¡œ ê°ì‹¸ì„œ JSONìœ¼ë¡œ ë³´ë‚´ê³  ìˆì—ˆëŠ”ë°
ì´ê±¸ DTO ì—†ì´ Mapìœ¼ë¡œ ì²˜ë¦¬í•˜ë ¤ëŠ” ê±°ì£ ?

ì¦‰,

{ "type": "chat", "message": "ì•ˆë…•í•˜ì„¸ìš”", "sender": "user1" }


ì´ëŸ° ì‹ìœ¼ë¡œ ë™ì ìœ¼ë¡œ ë§Œë“¤ê³  ì‹¶ë‹¤ëŠ” ëœ»ì´ì—ìš” âœ…

ê·¸ëŸ¼ ì•„ë˜ ì˜ˆì‹œëŠ” DTO ì—†ì´ Map ê¸°ë°˜ìœ¼ë¡œ ë™ì‘í•˜ëŠ” ì™„ì„± ì˜ˆì œì…ë‹ˆë‹¤.
ì£¼ì„ê¹Œì§€ ë‹¤ ë‹¬ì•„ë“œë¦´ê²Œìš” ğŸ‘‡

âœ… ì˜ˆì œ ì½”ë“œ (Map ê¸°ë°˜ WebSocket Endpoint)
package com.kedu.endpoints;

import java.util.Collections;
import java.util.HashMap;
import java.util.HashSet;
import java.util.Map;
import java.util.Set;

import javax.servlet.http.HttpSession;
import javax.websocket.EndpointConfig;
import javax.websocket.OnClose;
import javax.websocket.OnError;
import javax.websocket.OnMessage;
import javax.websocket.OnOpen;
import javax.websocket.Session;
import javax.websocket.server.ServerEndpoint;

import com.google.gson.Gson;
import com.kedu.config.SpringProvider;
import com.kedu.config.WebSocketConfigurator;
import com.kedu.services.ChatService;

@ServerEndpoint(value = "/chat", configurator = WebSocketConfigurator.class)
public class CatEndpoint {

    // ğŸ”¹ HttpSessionì€ ì›¹ì†Œì¼“ì˜ ì—°ê²° ì£¼ì²´ (ë¡œê·¸ì¸ ì •ë³´ ë“±)ê³¼ ì—°ë™ìš©
    private HttpSession hSession;

    // ğŸ”¹ JSON ì§ë ¬í™”ìš©
    private static Gson gson = new Gson();

    // ğŸ”¹ ì ‘ì† ì¤‘ì¸ ëª¨ë“  í´ë¼ì´ì–¸íŠ¸ ì„¸ì…˜ì„ ì €ì¥
    public static Set<Session> clients = Collections.synchronizedSet(new HashSet<>());

    // ğŸ”¹ Spring Bean ì§ì ‘ ì£¼ì… (SpringProvider ì´ìš©)
    private ChatService cServ = SpringProvider.ctx.getBean(ChatService.class);

    // ======================== ì—°ê²° ì‹œ ì‹¤í–‰ ========================
    @OnOpen
    public void onConnection(Session session, EndpointConfig config) {
        clients.add(session);
        this.hSession = (HttpSession) config.getUserProperties().get("hSession");

        String loginId = (String) this.hSession.getAttribute("loginID");
        System.out.println("[WebSocket] í´ë¼ì´ì–¸íŠ¸ ì ‘ì† : " + loginId + " / ì„¸ì…˜ ID : " + session.getId());

        // ğŸ”¹ ì ‘ì† ì•Œë¦¼ ë©”ì‹œì§€ Map
        Map<String, Object> joinMsg = new HashMap<>();
        joinMsg.put("type", "join");
        joinMsg.put("user", loginId);
        joinMsg.put("message", loginId + "ë‹˜ì´ ì…ì¥í–ˆìŠµë‹ˆë‹¤.");

        broadcast(joinMsg);
    }

    // ======================== ë©”ì‹œì§€ ìˆ˜ì‹  ì‹œ ì‹¤í–‰ ========================
    @OnMessage
    public void onMessage(String message, Session session) {
        String loginId = (String) this.hSession.getAttribute("loginID");

        System.out.println("[WebSocket] ë©”ì‹œì§€ ìˆ˜ì‹  : " + message + " / ë³´ë‚¸ ì‚¬ëŒ : " + loginId);

        // ğŸ”¹ DB ì €ì¥ (í•„ìš” ì‹œ ì„œë¹„ìŠ¤ì—ì„œ ì²˜ë¦¬)
        cServ.isert(message);

        // ğŸ”¹ Mapìœ¼ë¡œ ë©”ì‹œì§€ êµ¬ì¡° êµ¬ì„±
        Map<String, Object> msg = new HashMap<>();
        msg.put("type", "chat");             // ë©”ì‹œì§€ ìœ í˜•
        msg.put("user", loginId);            // ë³´ë‚¸ ì‚¬ëŒ
        msg.put("message", message);         // ì‹¤ì œ ë©”ì‹œì§€
        msg.put("timestamp", System.currentTimeMillis()); // ë³´ë‚¸ ì‹œê° (optional)

        // ğŸ”¹ ì „ì²´ ë¸Œë¡œë“œìºìŠ¤íŠ¸
        broadcast(msg);
    }

    // ======================== í´ë¼ì´ì–¸íŠ¸ ì—°ê²° ì¢…ë£Œ ========================
    @OnClose
    public void onClose(Session session) {
        clients.remove(session);
        String loginId = (String) this.hSession.getAttribute("loginID");

        System.out.println("[WebSocket] í´ë¼ì´ì–¸íŠ¸ ì¢…ë£Œ : " + loginId + " / ì„¸ì…˜ ID : " + session.getId());

        // ğŸ”¹ í‡´ì¥ ë©”ì‹œì§€
        Map<String, Object> leaveMsg = new HashMap<>();
        leaveMsg.put("type", "leave");
        leaveMsg.put("user", loginId);
        leaveMsg.put("message", loginId + "ë‹˜ì´ í‡´ì¥í–ˆìŠµë‹ˆë‹¤.");

        broadcast(leaveMsg);
    }

    // ======================== ì—ëŸ¬ ë°œìƒ ì‹œ ì‹¤í–‰ ========================
    @OnError
    public void onError(Session session, Throwable t) {
        clients.remove(session);
        System.err.println("[WebSocket] ì—ëŸ¬ ë°œìƒ: " + t.getMessage());
        t.printStackTrace();
    }

    // ======================== ê³µí†µ ë¸Œë¡œë“œìºìŠ¤íŠ¸ ë©”ì„œë“œ ========================
    private void broadcast(Map<String, Object> messageMap) {
        String jsonMessage = gson.toJson(messageMap);

        synchronized (clients) {
            for (Session client : clients) {
                try {
                    client.getBasicRemote().sendText(jsonMessage);
                } catch (Exception e) {
                    e.printStackTrace();
                }
            }
        }
    }
}

ğŸ” ìš”ì•½ ì„¤ëª…